SUBROUTINE mul2m(A1,M1,K1,L1,N1,A2,M2,K2,L2,N2,A,M,K,L,N)
! ======================================================================
! A(K:K+N1,L:L+N) = A1(K1:K1+N1,L1:L1+N2) *
!                   A2(K2:K2+N2,L2:L2+N3)
! ======================================================================
! KI  I4  >0: NORMAL USAGE
!         <0: TRANSPOSE IS USED
! ======================================================================
   IMPLICIT NONE
   REAL*8 A , A1 , A2 , f1 , f2
   INTEGER*4 i , i1 , i2 , ic , ir , K , K1 , K2 , L , L1 , L2 , M , M1 , M2 , N , N1 , N2
! ======================================================================
   DIMENSION A1(M1,*) , A2(M2,*) , A(M,*)
! ======================================================================
   DO i1 = K , K + N1 - 1
      DO i = L , L + N - 1
         A(i1,i) = 0D0
      ENDDO
   ENDDO
! ======================================================================
   DO i1 = 0 , N1 - 1
! ----------------------------------------------------------------------
      DO i2 = 0 , N2 - 1
         IF ( K1>=0 ) THEN
            f1 = A1(i1+K1,i2+L1)
         ELSE
            f1 = A1(i2-K1,i1+L1)
         ENDIF
         IF ( f1/=0D0 ) THEN
! ----------------------------------------------------------------------
            DO i = 0 , N - 1
               IF ( K2>=0 ) THEN
                  f2 = A2(i2+K2,i+L2)
               ELSE
                  f2 = A2(i-K2,i2+L2)
               ENDIF
               IF ( f2/=0D0 ) THEN
                  f2 = f2*f1
                  ic = i1 + K
                  ir = i + L
                  A(ic,ir) = A(ic,ir) + f2
               ENDIF
            ENDDO
         ENDIF
! ----------------------------------------------------------------------
      ENDDO
! ----------------------------------------------------------------------
   ENDDO
! ======================================================================
END SUBROUTINE mul2m
